

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Us Form - EMS</title>

    <link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://code.jquery.com/ui/1.11.3/themes/smoothness/jquery-ui.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" rel="stylesheet" />




    <style>
        body {
            padding: 10px;
            background-color: white !important;
        }

        input[type=checkbox].error {
            outline: 4px solid red;
        }

        .input-validation-error, .error {
            color: #b94a48 !important;
            background-color: #f2dede !important;
            border-color: #eed3d7 !important;
        }

        .ui-autocomplete {
            max-height: 300px;
            overflow-y: auto;
            overflow-x: hidden;
            z-index: 9999;
        }

        .dropdown-menu > li > a {
            border-radius: 3px;
            line-height: 25px;
            margin: 4px;
            text-align: left;
            cursor: pointer;
        }

            .dropdown-menu > li > a label {
                cursor: pointer;
            }
    </style>
    <script src="https://code.jquery.com/jquery-1.11.3.js?42095"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.11.1/jquery.validate.min.js"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/libphonenumber-js/1.9.8/libphonenumber-js.min.js" type="text/javascript"></script>

    <script type="text/javascript">
        !function (t) { "use strict"; function e(e, i) { this.$select = t(e), this.$select.attr("data-placeholder") && (i.nonSelectedText = this.$select.data("placeholder")), this.options = this.mergeOptions(t.extend({}, i, this.$select.data())), this.originalOptions = this.$select.clone()[0].options, this.query = "", this.searchTimeout = null, this.lastToggledInput = null, this.options.multiple = "multiple" === this.$select.attr("multiple"), this.options.onChange = t.proxy(this.options.onChange, this), this.options.onDropdownShow = t.proxy(this.options.onDropdownShow, this), this.options.onDropdownHide = t.proxy(this.options.onDropdownHide, this), this.options.onDropdownShown = t.proxy(this.options.onDropdownShown, this), this.options.onDropdownHidden = t.proxy(this.options.onDropdownHidden, this), this.buildContainer(), this.buildButton(), this.buildDropdown(), this.buildSelectAll(), this.buildDropdownOptions(), this.buildFilter(), this.updateButtonText(), this.updateSelectAll(), this.options.disableIfEmpty && t("option", this.$select).length <= 0 && this.disable(), this.$select.hide().after(this.$container) } "undefined" != typeof ko && ko.bindingHandlers && !ko.bindingHandlers.multiselect && (ko.bindingHandlers.multiselect = { after: ["options", "value", "selectedOptions"], init: function (e, i, s, l, o) { var n = t(e), a = ko.toJS(i()); if (n.multiselect(a), s.has("options")) { var p = s.get("options"); ko.isObservable(p) && ko.computed({ read: function () { p(), setTimeout(function () { var t = n.data("multiselect"); t && t.updateOriginalOptions(), n.multiselect("rebuild") }, 1) }, disposeWhenNodeIsRemoved: e }) } if (s.has("value")) { var h = s.get("value"); ko.isObservable(h) && ko.computed({ read: function () { h(), setTimeout(function () { n.multiselect("refresh") }, 1) }, disposeWhenNodeIsRemoved: e }).extend({ rateLimit: 100, notifyWhenChangesStop: !0 }) } if (s.has("selectedOptions")) { var c = s.get("selectedOptions"); ko.isObservable(c) && ko.computed({ read: function () { c(), setTimeout(function () { n.multiselect("refresh") }, 1) }, disposeWhenNodeIsRemoved: e }).extend({ rateLimit: 100, notifyWhenChangesStop: !0 }) } ko.utils.domNodeDisposal.addDisposeCallback(e, function () { n.multiselect("destroy") }) }, update: function (e, i, s, l, o) { var n = t(e), a = ko.toJS(i()); n.multiselect("setOptions", a), n.multiselect("rebuild") } }), e.prototype = { defaults: { buttonText: function (e, i) { if (0 === e.length) return this.nonSelectedText; if (this.allSelectedText && e.length === t("option", t(i)).length && 1 !== t("option", t(i)).length && this.multiple) return this.selectAllNumber ? this.allSelectedText + " (" + e.length + ")" : this.allSelectedText; if (e.length > this.numberDisplayed) return e.length + " " + this.nSelectedText; var s = "", l = this.delimiterText; return e.each(function () { var e = void 0 !== t(this).attr("label") ? t(this).attr("label") : t(this).text(); s += e + l }), s.substr(0, s.length - 2) }, buttonTitle: function (e, i) { if (0 === e.length) return this.nonSelectedText; var s = "", l = this.delimiterText; return e.each(function () { var e = void 0 !== t(this).attr("label") ? t(this).attr("label") : t(this).text(); s += e + l }), s.substr(0, s.length - 2) }, optionLabel: function (e) { return t(e).attr("label") || t(e).text() }, onChange: function (t, e) { }, onDropdownShow: function (t) { }, onDropdownHide: function (t) { }, onDropdownShown: function (t) { }, onDropdownHidden: function (t) { }, onSelectAll: function () { }, enableHTML: !1, buttonClass: "btn btn-default", inheritClass: !1, buttonWidth: "auto", buttonContainer: '<div class="btn-group" />', dropRight: !1, selectedClass: "active", maxHeight: !1, checkboxName: !1, includeSelectAllOption: !1, includeSelectAllIfMoreThan: 0, selectAllText: " Select all", selectAllValue: "multiselect-all", selectAllName: !1, selectAllNumber: !0, enableFiltering: !1, enableCaseInsensitiveFiltering: !1, enableClickableOptGroups: !1, filterPlaceholder: "Search", filterBehavior: "text", includeFilterClearBtn: !0, preventInputChangeEvent: !1, nonSelectedText: "None selected", nSelectedText: "selected", allSelectedText: "All selected", numberDisplayed: 3, disableIfEmpty: !1, delimiterText: ", ", templates: { button: '<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span> <b class="caret"></b></button>', ul: '<ul class="multiselect-container dropdown-menu"></ul>', filter: '<li class="multiselect-item filter"><div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span><input class="form-control multiselect-search" type="text"></div></li>', filterClearBtn: '<span class="input-group-btn"><button class="btn btn-default multiselect-clear-filter" type="button"><i class="glyphicon glyphicon-remove-circle"></i></button></span>', li: '<li><a tabindex="0"><label></label></a></li>', divider: '<li class="multiselect-item divider"></li>', liGroup: '<li class="multiselect-item multiselect-group"><label></label></li>' } }, constructor: e, buildContainer: function () { this.$container = t(this.options.buttonContainer), this.$container.on("show.bs.dropdown", this.options.onDropdownShow), this.$container.on("hide.bs.dropdown", this.options.onDropdownHide), this.$container.on("shown.bs.dropdown", this.options.onDropdownShown), this.$container.on("hidden.bs.dropdown", this.options.onDropdownHidden) }, buildButton: function () { this.$button = t(this.options.templates.button).addClass(this.options.buttonClass), this.$select.attr("class") && this.options.inheritClass && this.$button.addClass(this.$select.attr("class")), this.$select.prop("disabled") ? this.disable() : this.enable(), this.options.buttonWidth && "auto" !== this.options.buttonWidth && (this.$button.css({ width: this.options.buttonWidth, overflow: "hidden", "text-overflow": "ellipsis" }), this.$container.css({ width: this.options.buttonWidth })); var e = this.$select.attr("tabindex"); e && this.$button.attr("tabindex", e), this.$container.prepend(this.$button) }, buildDropdown: function () { this.$ul = t(this.options.templates.ul), this.options.dropRight && this.$ul.addClass("pull-right"), this.options.maxHeight && this.$ul.css({ "max-height": this.options.maxHeight + "px", "overflow-y": "auto", "overflow-x": "hidden" }), this.$container.append(this.$ul) }, buildDropdownOptions: function () { this.$select.children().each(t.proxy(function (e, i) { var s = t(i), l = s.prop("tagName").toLowerCase(); s.prop("value") !== this.options.selectAllValue && ("optgroup" === l ? this.createOptgroup(i) : "option" === l && ("divider" === s.data("role") ? this.createDivider() : this.createOptionValue(i))) }, this)), t("li input", this.$ul).on("change", t.proxy(function (e) { var i = t(e.target), s = i.prop("checked") || !1, l = i.val() === this.options.selectAllValue; this.options.selectedClass && (s ? i.closest("li").addClass(this.options.selectedClass) : i.closest("li").removeClass(this.options.selectedClass)); var o = i.val(), n = this.getOptionByValue(o), a = t("option", this.$select).not(n), p = t("input", this.$container).not(i); if (l && (s ? this.selectAll() : this.deselectAll()), l || (s ? (n.prop("selected", !0), this.options.multiple ? n.prop("selected", !0) : (this.options.selectedClass && t(p).closest("li").removeClass(this.options.selectedClass), t(p).prop("checked", !1), a.prop("selected", !1), this.$button.click()), "active" === this.options.selectedClass && a.closest("a").css("outline", "")) : n.prop("selected", !1)), this.$select.change(), this.updateButtonText(), this.updateSelectAll(), this.options.onChange(n, s), this.options.preventInputChangeEvent) return !1 }, this)), t("li a", this.$ul).on("mousedown", function (t) { if (t.shiftKey) return !1 }), t("li a", this.$ul).on("touchstart click", t.proxy(function (e) { e.stopPropagation(); var i = t(e.target); if (e.shiftKey && this.options.multiple) { i.is("label") && (e.preventDefault(), (i = i.find("input")).prop("checked", !i.prop("checked"))); var s = i.prop("checked") || !1; if (null !== this.lastToggledInput && this.lastToggledInput !== i) { var l = i.closest("li").index(), o = this.lastToggledInput.closest("li").index(); if (l > o) { var n = o; o = l, l = n } ++o; var a = this.$ul.find("li").slice(l, o).find("input"); a.prop("checked", s), this.options.selectedClass && a.closest("li").toggleClass(this.options.selectedClass, s); for (var p = 0, h = a.length; p < h; p++) { var c = t(a[p]); this.getOptionByValue(c.val()).prop("selected", s) } } i.trigger("change") } i.is("input") && !i.closest("li").is(".multiselect-item") && (this.lastToggledInput = i), i.blur() }, this)), this.$container.off("keydown.multiselect").on("keydown.multiselect", t.proxy(function (e) { if (!t('input[type="text"]', this.$container).is(":focus")) if (9 === e.keyCode && this.$container.hasClass("open")) this.$button.click(); else { var i = t(this.$container).find("li:not(.divider):not(.disabled) a").filter(":visible"); if (!i.length) return; var s = i.index(i.filter(":focus")); 38 === e.keyCode && s > 0 ? s-- : 40 === e.keyCode && s < i.length - 1 ? s++ : ~s || (s = 0); var l = i.eq(s); if (l.focus(), 32 === e.keyCode || 13 === e.keyCode) { var o = l.find("input"); o.prop("checked", !o.prop("checked")), o.change() } e.stopPropagation(), e.preventDefault() } }, this)), this.options.enableClickableOptGroups && this.options.multiple && t("li.multiselect-group", this.$ul).on("click", t.proxy(function (e) { e.stopPropagation(); var i = t(e.target).parent().nextUntil("li.multiselect-group").filter(":visible:not(.disabled)"), s = !0, l = i.find("input"); l.each(function () { s = s && t(this).prop("checked") }), l.prop("checked", !s).trigger("change") }, this)) }, createOptionValue: function (e) { var i = t(e); i.is(":selected") && i.prop("selected", !0); var s = this.options.optionLabel(e), l = i.val(), o = this.options.multiple ? "checkbox" : "radio", n = t(this.options.templates.li), a = t("label", n); a.addClass(o), this.options.enableHTML ? a.html(" " + s) : a.text(" " + s); var p = t("<input/>").attr("type", o); this.options.checkboxName && p.attr("name", this.options.checkboxName), a.prepend(p); var h = i.prop("selected") || !1; p.val(l), l === this.options.selectAllValue && (n.addClass("multiselect-item multiselect-all"), p.parent().parent().addClass("multiselect-all")), a.attr("title", i.attr("title")), this.$ul.append(n), i.is(":disabled") && p.attr("disabled", "disabled").prop("disabled", !0).closest("a").attr("tabindex", "-1").closest("li").addClass("disabled"), p.prop("checked", h), h && this.options.selectedClass && p.closest("li").addClass(this.options.selectedClass) }, createDivider: function (e) { var i = t(this.options.templates.divider); this.$ul.append(i) }, createOptgroup: function (e) { var i = t(e).prop("label"), s = t(this.options.templates.liGroup); this.options.enableHTML ? t("label", s).html(i) : t("label", s).text(i), this.options.enableClickableOptGroups && s.addClass("multiselect-group-clickable"), this.$ul.append(s), t(e).is(":disabled") && s.addClass("disabled"), t("option", e).each(t.proxy(function (t, e) { this.createOptionValue(e) }, this)) }, buildSelectAll: function () { if ("number" == typeof this.options.selectAllValue && (this.options.selectAllValue = this.options.selectAllValue.toString()), !this.hasSelectAll() && this.options.includeSelectAllOption && this.options.multiple && t("option", this.$select).length > this.options.includeSelectAllIfMoreThan) { this.options.includeSelectAllDivider && this.$ul.prepend(t(this.options.templates.divider)); var e = t(this.options.templates.li); t("label", e).addClass("checkbox"), this.options.enableHTML ? t("label", e).html(" " + this.options.selectAllText) : t("label", e).text(" " + this.options.selectAllText), this.options.selectAllName ? t("label", e).prepend('<input type="checkbox" name="' + this.options.selectAllName + '" />') : t("label", e).prepend('<input type="checkbox" />'); var i = t("input", e); i.val(this.options.selectAllValue), e.addClass("multiselect-item multiselect-all"), i.parent().parent().addClass("multiselect-all"), this.$ul.prepend(e), i.prop("checked", !1) } }, buildFilter: function () { if (this.options.enableFiltering || this.options.enableCaseInsensitiveFiltering) { var e = Math.max(this.options.enableFiltering, this.options.enableCaseInsensitiveFiltering); if (this.$select.find("option").length >= e) { if (this.$filter = t(this.options.templates.filter), t("input", this.$filter).attr("placeholder", this.options.filterPlaceholder), this.options.includeFilterClearBtn) { var i = t(this.options.templates.filterClearBtn); i.on("click", t.proxy(function (e) { clearTimeout(this.searchTimeout), this.$filter.find(".multiselect-search").val(""), t("li", this.$ul).show().removeClass("filter-hidden"), this.updateSelectAll() }, this)), this.$filter.find(".input-group").append(i) } this.$ul.prepend(this.$filter), this.$filter.val(this.query).on("click", function (t) { t.stopPropagation() }).on("input keydown", t.proxy(function (e) { 13 === e.which && e.preventDefault(), clearTimeout(this.searchTimeout), this.searchTimeout = this.asyncFunction(t.proxy(function () { var i, s; this.query !== e.target.value && (this.query = e.target.value, t.each(t("li", this.$ul), t.proxy(function (e, l) { var o = t("input", l).length > 0 ? t("input", l).val() : "", n = t("label", l).text(), a = ""; if ("text" === this.options.filterBehavior ? a = n : "value" === this.options.filterBehavior ? a = o : "both" === this.options.filterBehavior && (a = n + "\n" + o), o !== this.options.selectAllValue && n) { var p = !1; this.options.enableCaseInsensitiveFiltering && a.toLowerCase().indexOf(this.query.toLowerCase()) > -1 ? p = !0 : a.indexOf(this.query) > -1 && (p = !0), t(l).toggle(p).toggleClass("filter-hidden", !p), t(l).hasClass("multiselect-group") ? (i = l, s = p) : (p && t(i).show().removeClass("filter-hidden"), !p && s && t(l).show().removeClass("filter-hidden")) } }, this))); this.updateSelectAll() }, this), 300, this) }, this)) } } }, destroy: function () { this.$container.remove(), this.$select.show(), this.$select.data("multiselect", null) }, refresh: function () { t("option", this.$select).each(t.proxy(function (e, i) { var s = t("li input", this.$ul).filter(function () { return t(this).val() === t(i).val() }); t(i).is(":selected") ? (s.prop("checked", !0), this.options.selectedClass && s.closest("li").addClass(this.options.selectedClass)) : (s.prop("checked", !1), this.options.selectedClass && s.closest("li").removeClass(this.options.selectedClass)), t(i).is(":disabled") ? s.attr("disabled", "disabled").prop("disabled", !0).closest("li").addClass("disabled") : s.prop("disabled", !1).closest("li").removeClass("disabled") }, this)), this.updateButtonText(), this.updateSelectAll() }, select: function (e, i) { t.isArray(e) || (e = [e]); for (var s = 0; s < e.length; s++) { var l = e[s]; if (null != l) { var o = this.getOptionByValue(l), n = this.getInputByValue(l); void 0 !== o && void 0 !== n && (this.options.multiple || this.deselectAll(!1), this.options.selectedClass && n.closest("li").addClass(this.options.selectedClass), n.prop("checked", !0), o.prop("selected", !0), i && this.options.onChange(o, !0)) } } this.updateButtonText(), this.updateSelectAll() }, clearSelection: function () { this.deselectAll(!1), this.updateButtonText(), this.updateSelectAll() }, deselect: function (e, i) { t.isArray(e) || (e = [e]); for (var s = 0; s < e.length; s++) { var l = e[s]; if (null != l) { var o = this.getOptionByValue(l), n = this.getInputByValue(l); void 0 !== o && void 0 !== n && (this.options.selectedClass && n.closest("li").removeClass(this.options.selectedClass), n.prop("checked", !1), o.prop("selected", !1), i && this.options.onChange(o, !1)) } } this.updateButtonText(), this.updateSelectAll() }, selectAll: function (e, i) { e = void 0 === e || e; var s = t("li input[type='checkbox']:enabled", this.$ul), l = s.filter(":visible"), o = s.length, n = l.length; if (e ? (l.prop("checked", !0), t("li:not(.divider):not(.disabled)", this.$ul).filter(":visible").addClass(this.options.selectedClass)) : (s.prop("checked", !0), t("li:not(.divider):not(.disabled)", this.$ul).addClass(this.options.selectedClass)), o === n || !1 === e) t("option:enabled", this.$select).prop("selected", !0); else { var a = l.map(function () { return t(this).val() }).get(); t("option:enabled", this.$select).filter(function (e) { return -1 !== t.inArray(t(this).val(), a) }).prop("selected", !0) } i && this.options.onSelectAll() }, deselectAll: function (e) { if (e = void 0 === e || e) { var i = t("li input[type='checkbox']:not(:disabled)", this.$ul).filter(":visible"); i.prop("checked", !1); var s = i.map(function () { return t(this).val() }).get(); t("option:enabled", this.$select).filter(function (e) { return -1 !== t.inArray(t(this).val(), s) }).prop("selected", !1), this.options.selectedClass && t("li:not(.divider):not(.disabled)", this.$ul).filter(":visible").removeClass(this.options.selectedClass) } else t("li input[type='checkbox']:enabled", this.$ul).prop("checked", !1), t("option:enabled", this.$select).prop("selected", !1), this.options.selectedClass && t("li:not(.divider):not(.disabled)", this.$ul).removeClass(this.options.selectedClass) }, rebuild: function () { this.$ul.html(""), this.options.multiple = "multiple" === this.$select.attr("multiple"), this.buildSelectAll(), this.buildDropdownOptions(), this.buildFilter(), this.updateButtonText(), this.updateSelectAll(), this.options.disableIfEmpty && t("option", this.$select).length <= 0 ? this.disable() : this.enable(), this.options.dropRight && this.$ul.addClass("pull-right") }, dataprovider: function (e) { var i = 0, s = this.$select.empty(); t.each(e, function (e, l) { var o; t.isArray(l.children) ? (i++, o = t("<optgroup/>").attr({ label: l.label || "Group " + i, disabled: !!l.disabled }), function (t, e) { for (var i = 0; i < t.length; ++i)e(t[i], i) }(l.children, function (e) { o.append(t("<option/>").attr({ value: e.value, label: e.label || e.value, title: e.title, selected: !!e.selected, disabled: !!e.disabled })) })) : o = t("<option/>").attr({ value: l.value, label: l.label || l.value, title: l.title, selected: !!l.selected, disabled: !!l.disabled }), s.append(o) }), this.rebuild() }, enable: function () { this.$select.prop("disabled", !1), this.$button.prop("disabled", !1).removeClass("disabled") }, disable: function () { this.$select.prop("disabled", !0), this.$button.prop("disabled", !0).addClass("disabled") }, setOptions: function (t) { this.options = this.mergeOptions(t) }, mergeOptions: function (e) { return t.extend(!0, {}, this.defaults, this.options, e) }, hasSelectAll: function () { return t("li.multiselect-all", this.$ul).length > 0 }, updateSelectAll: function () { if (this.hasSelectAll()) { var e = t("li:not(.multiselect-item):not(.filter-hidden) input:enabled", this.$ul), i = e.length, s = e.filter(":checked").length, l = t("li.multiselect-all", this.$ul), o = l.find("input"); s > 0 && s === i ? (o.prop("checked", !0), l.addClass(this.options.selectedClass), this.options.onSelectAll()) : (o.prop("checked", !1), l.removeClass(this.options.selectedClass)) } }, updateButtonText: function () { var e = this.getSelected(); this.options.enableHTML ? t(".multiselect .multiselect-selected-text", this.$container).html(this.options.buttonText(e, this.$select)) : t(".multiselect .multiselect-selected-text", this.$container).text(this.options.buttonText(e, this.$select)), t(".multiselect", this.$container).attr("title", this.options.buttonTitle(e, this.$select)) }, getSelected: function () { return t("option", this.$select).filter(":selected") }, getOptionByValue: function (e) { for (var i = t("option", this.$select), s = e.toString(), l = 0; l < i.length; l += 1) { var o = i[l]; if (o.value === s) return t(o) } }, getInputByValue: function (e) { for (var i = t("li input", this.$ul), s = e.toString(), l = 0; l < i.length; l += 1) { var o = i[l]; if (o.value === s) return t(o) } }, updateOriginalOptions: function () { this.originalOptions = this.$select.clone()[0].options }, asyncFunction: function (t, e, i) { var s = Array.prototype.slice.call(arguments, 3); return setTimeout(function () { t.apply(i || window, s) }, e) }, setAllSelectedText: function (t) { this.options.allSelectedText = t, this.updateButtonText() } }, t.fn.multiselect = function (i, s, l) { return this.each(function () { var o = t(this).data("multiselect"); o || (o = new e(this, "object" == typeof i && i), t(this).data("multiselect", o)), "string" == typeof i && (o[i](s, l), "destroy" === i && t(this).data("multiselect", !1)) }) }, t.fn.multiselect.Constructor = e, t(function () { t("select[data-role=multiselect]").multiselect() }) }(window.jQuery);
    </script>
</head>
<body>
    <br />
    <div class="row">
        <div class="col-sm-6">
            <div class="form-group row">
                <div class="col-sm-12 alert alert-success" id="successContainer" style="display: none;">
                    Thank you for contacting us.   We will be in touch soon regarding your enquiry. <br />
                    Click <a href="/leadapitest.html">here</a> to go back.
                </div>
                <div class="col-sm-12 alert alert-danger" id="errorContainer" style="display: none;"></div>
            </div>
            <form action="/ContactUs/ContactForm" id="editForm" method="post">
                <div class="form-group row">
                    <label class="control-label col-sm-3" for="chkAccept">222Please confirm that you are happy for us to pass your information on to installers.</label>
                    <div class="col-sm-9">
                        <input type="checkbox" id="OkayToPassOn" name="OkayToPassOn" value="true" autofocus="autofocus" />
                    </div>
                </div>
                <div class="form-group row">
                    <label class="control-label col-sm-3" for="PreferedMethodOfContact">
                        Please confirm that you are happy for us to contact you by selecting your preferred method of contact.
                    </label>
                    <div class="col-sm-9">
                        <select id="PreferedMethodOfContact" name="PreferedMethodOfContact" class="form-control" multiple="multiple">
                            <option value="1">Email</option>
                            <option value="2">Phone</option>
                            <option value="4">Post</option>
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3 control-label" for="TitleId">Title</label>
                    <div class="col-sm-9">
                        <select class="form-control" data-val="true" id="TitleId" name="TitleId" required="required"></select>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3  control-label" for="FirstName">First Name <span class="text-danger">*</span></label>

                    <div class="col-sm-9">
                        <input type="text" class="form-control" data-val="true" id="FirstName" name="FirstName" required="required" maxlength="40" />
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3  control-label" for="LastName">Last Name <span class="text-danger">*</span></label>

                    <div class="col-sm-9">
                        <input class="form-control" id="LastName" name="LastName" type="text" required="required" maxlength="39" />
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3 control-label" for="EmailAddress">Email <span class="text-danger dynamicRequiredLabel" id="lblRequiredEmail" style="display: none;">*</span></label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" id="EmailAddress" name="EmailAddress" maxlength="50" />
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3 control-label" for="PostCode">Post Code <span class="text-danger">*</span></label>
                    <div class="col-sm-9">
                        <div class="form-group row">
                            <div class="col-md-3 col-sm-3">
                                <div class="input-group" id="txtPostCodeContainer">
                                    <input type="text" class="form-control" id="txtPostCode" name="PostCode" maxlength="20" required="required" />
                                    <span class="input-group-addon" style="display: none;" id="txtPostCodeSpinner"><i class="fa fa-cog fa-spin fa-spinner"> </i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3 control-label" for="Address">Address <span class="text-danger dynamicRequiredLabel" id="lblRequiredAddress" style="display: none;">*</span></label>
                    <div class="col-sm-9">
                        <textarea class="form-control" id="Address" name="Address" maxlength="255"></textarea>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3 control-label" for="City">City <span class="text-danger dynamicRequiredLabel" id="lblRequiredCity" style="display: none;">*</span></label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" id="txtCity" name="City" maxlength="50" />
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3  control-label" for="County">County</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" id="txtCounty" name="County" maxlength="50" />
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3 control-label" for="CountryId">Country</label>
                    <div class="col-sm-9">
                        <select class="form-control" id="ddlCountries" name="CountryId"></select>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3 control-label" for="PhoneNumber">Telephone <span class="text-danger dynamicRequiredLabel" id="lblRequiredTelephone" style="display: none;">*</span></label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control format-phone" id="PhoneNumber" name="PhoneNumber" maxlength="30" />
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3 control-label" for="MobilePhone">Mobile</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" id="MobilePhone" name="MobilePhone" maxlength="50" />
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-3 control-label" for="Notes">Please tell us more about how we can help you</label>
                    <div class="col-sm-9">
                        <textarea class="form-control" id="Notes" name="Notes"></textarea>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="control-label col-sm-12">
                        <br />
                        You are entitled to withdraw your permission to be contacted at any time by emailing:
                        <a id="unsubscribeEmailLink" href="mailto:admin@mplogic.co.uk">admin@mplogic.co.uk</a>
                    </label>
                </div>
                <div class=" row form-group">
                    <div class="col-sm-12 text-right">
                        <button type="button" class="control-label btn btn-primary" id="btnSave">
                            Submit
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script type="text/javascript">
        var baseUrl = 'https://mpl-ems-dev.edensoftware.co.uk';
        let options = {};
        let preferdMethodOfContacts = {
            email: "1",
            phone: "2",
            post: "4"
        };
        $(document).ready(function () {
            var phoneFormatter = new libphonenumber.AsYouType('GB');
            $('.format-phone').change(function () {
                $(this).val(phoneFormatter.reset().input($(this).val()));
            });
            $.ajax({
                url: baseUrl + '/ContactUs/GetLeadOptions?Authorization=8C613AD1-A4C7-4A2E-8676-4293188F242A',
                type: 'get',
                dataType: 'json',
                crossDomain: true,
                headers: {
                    "accept": "application/json",
                    "Access-Control-Allow-Origin": "*"
                },
                success: function (data) {
                    options = data;
                    $('label[for=chkAccept]').html(data.passOnInfo);

                    $('#unsubscribeEmailLink').attr('href', 'mailto:' + data.unsubscribeEmail).html(data.unsubscribeEmail);
                    populateDropdown('CountryId', options.countries);
                    populateDropdown('TitleId', options.titles);

                    var countryId = options.countries.filter(t => t.description === 'United Kingdom')[0].id;
                    $('[name=CountryId]').val(countryId + "");
                }
            });
            jQuery.validator.addMethod("emailMethodofContactEmailAddressRequired", function (value, element) {
                var isEmailSelected = ($('#PreferedMethodOfContact').val() || []).indexOf(preferdMethodOfContacts.email) >= 0;
                var isValid = !isEmailSelected || $('#EmailAddress').val().trim();
                return isValid;
            }, "* Email is required");
            jQuery.validator.addMethod("phoneMethodofContactPhoneNumberRequired", function (value, element) {
                var isPhoneSelected = ($('#PreferedMethodOfContact').val() || []).indexOf(preferdMethodOfContacts.phone) >= 0;
                return !isPhoneSelected || $('#PhoneNumber').val().trim();
            }, "* Phone Number is required");
            jQuery.validator.addMethod("postMethodofContactPostCodeRequired", function (value, element) {
                var isPostSelected = ($('#PreferedMethodOfContact').val() || []).indexOf(preferdMethodOfContacts.post) >= 0;
                return !isPostSelected || $('#txtPostCode').val().trim();
            }, "* Post Code is required");
            jQuery.validator.addMethod("postMethodofContactAddressRequired", function (value, element) {
                var isPostSelected = ($('#PreferedMethodOfContact').val() || []).indexOf(preferdMethodOfContacts.post) >= 0;
                return !isPostSelected || $('#Address').val().trim();
            }, "* Address is required");
            jQuery.validator.addMethod("postMethodofContactCityRequired", function (value, element) {
                var isPostSelected = ($('#PreferedMethodOfContact').val() || []).indexOf(preferdMethodOfContacts.post) >= 0;
                return !isPostSelected || $('#txtCity').val().trim();
            }, "* City is required");
            jQuery.validator.addMethod("okayToPassOnPostCodeRequired", function (value, element) {
                var isOkayToPassOnSelected = $('#OkayToPassOn').prop('checked');
                return !isOkayToPassOnSelected || $('#txtPostCode').val().trim();
            }, "* Post Code is required");
            $("#btnSave").click(function () {
                if ($("#editForm").valid()) {
                    $('#errorContainer').hide();
                    $('successContainer').hide();
                    $('#btnSave').prop('disabled', true);
                    var formData = getFormData($('#editForm'));
                    formData.AccountOwnerId = 1;

                    $.ajax({
                        url: baseUrl + '/ContactUs/SaveContactFormData',
                        type: 'POST',
                        data: JSON.stringify(formData),
                        dataType: 'json',
						 crossDomain: true,
						headers: {
							"Authorization": "8C613AD1-A4C7-4A2E-8676-4293188F242A",
							"accept": "application/json",
							"Access-Control-Allow-Origin": "*"
						},
                        success: function (res) {
                            $('#btnSave').prop('disabled', false);
                            if (res.success) {
                                $('#successContainer').show();
                                $('#editForm').hide();
                            } else {
                                $('#errorContainer').show().html(res.errorMessage);
                            }
                        },
                        error: function () {
                            $('#btnSave').prop('disabled', false);
                            $('#errorContainer').show().html("Unknown Server Error!");
                        }
                    });
                    return;
                }


            });
            $("#editForm").validate({
                rules: {
                    EmailAddress: { emailMethodofContactEmailAddressRequired: true },
                    PhoneNumber: { phoneMethodofContactPhoneNumberRequired: true },
                    PostCode: { postMethodofContactPostCodeRequired: true, okayToPassOnPostCodeRequired: true },
                    Address: { postMethodofContactAddressRequired: true },
                    City: { postMethodofContactCityRequired: true }
                }, errorPlacement: function (error, element) { }
            });
            $('#PreferedMethodOfContact').multiselect({
                numberDisplayed: 3,
                allSelectedText: false,
                onChange: function () {
                    onMethodOfContactsChanged();
                }
            });
            $('#OkayToPassOn').change(function () {
                onMethodOfContactsChanged();
            });
        });

        function onMethodOfContactsChanged() {
            $('.dynamicRequiredLabel').hide();
            var isEmailSelected = ($('#PreferedMethodOfContact').val() || []).indexOf(preferdMethodOfContacts.email) >= 0;
            var isPhoneSelected = ($('#PreferedMethodOfContact').val() || []).indexOf(preferdMethodOfContacts.phone) >= 0;
            var isPostSelected = ($('#PreferedMethodOfContact').val() || []).indexOf(preferdMethodOfContacts.post) >= 0;
            if (isEmailSelected)
                $('#lblRequiredEmail').show();
            if (isPhoneSelected)
                $('#lblRequiredTelephone').show();
            if (isPostSelected) {
                $('#lblRequiredPostCode').show();
                $('#lblRequiredAddress').show();
                $('#lblRequiredCity').show();
            } else {
                var isOkayToPassOnSelected = $('#OkayToPassOn').prop('checked');
                if (isOkayToPassOnSelected)
                    $('#lblRequiredPostCode').show();
                else
                    $('#lblRequiredPostCode').hide();
            }
        }

        function getFormData_old($form) {
            var unindexed_array = $form.serializeArray();
            var indexed_array = {};

            $.map(unindexed_array, function (n, i) {
                indexed_array[n['name']] = n['value'];
            });

            return indexed_array;
        }

        function getFormData($form) {
            var result = {};
            addStringProps(result, ['FirstName', 'LastName', 'EmailAddress', 'Address', 'City',
                'County', 'PostCode', 'PhoneNumber', 'MobilePhone', 'Notes']);
            addNumberProps(result, ['TitleId', 'CountryId']);
            result.OkayToPassOn = $('#OkayToPassOn:checked').length > 0;

            var methods = [];
            for (const method of $('#PreferedMethodOfContact').val()) {
                methods.push(parseInt(method));
            }
            result.PreferedMethodOfContact = methods;

            return result;
        }

        function addStringProps(result, props) {
            for (const prop of props) {
                var val = $('[name="' + prop + '"]').val();
                result[prop] = val.length > 0 ? val : null;
            }
        }

        function addNumberProps(result, props) {
            for (const prop of props) {
                var val = $('[name="' + prop + '"]').val();
                result[prop] = parseInt(val);
            }
        }

        function populateDropdown(name, options) {
            var el = $('[name=' + name + "]");
            $.each(options, function (i, item) {
                el.append($("<option />").val(item.id).text(item.description));
            });
        }

        (function ($) {

            var postCodeLookupBaseUrl = baseUrl + "/PostCodeLookup/GetFullAddresses";
            var ukCountryId = 222;

            var populateAddressFields = function (dataStr) {
                var fields = dataStr.split(',');
                if ($('#Address').is('textarea')) {
                    $('#Address').val(fields[0].trim() + '\r\n' + fields[1].trim() + (fields[4].trim() ? (fields[1].trim() ? ', ' + fields[4].trim() : fields[4].trim()) : ''));
                } else {
                    $('#Address').val(fields[0].trim() + ((fields[1] || '').trim() || (fields[4] || '').trim() ? ', ' : '') + fields[1].trim() + (fields[4].trim() ? (fields[1].trim() ? ', ' + fields[4].trim() : fields[4].trim()) : ''));
                }
                $('#txtCity').val(fields[5].trim() ? fields[5].trim() : (fields[4].trim() ? fields[4].trim() : ''));
                $('#txtCounty').val(fields[6]);
                $('#ddlCountries').val(ukCountryId);
            };

            var setUppercasePostcode = function () {
                var text = $('#txtPostCode,[name="Postcode"]').val() || '';
                var textUpperCase = text.toUpperCase();
                $('#txtPostCode,[name="Postcode"]').val(textUpperCase);
            };

            $(document).ready(function () {
                setUppercasePostcode();

                $('form').on('submit', function () {
                    setUppercasePostcode();
                });

                var cache = {};
                $("#txtPostCode").autocomplete({
                    minLength: 5,
                    maxHeight: 100,
                    source: function (request, response) {
                        var term = request.term;
                        if (term in cache) {
                            response(cache[term]);
                            return;
                        }
                        $('#txtPostCodeSpinner').show();
                        $.getJSON(postCodeLookupBaseUrl, request, function (data) {
                            if (!data.isError) {
                                cache[term] = data;
                            }
                            response(data);
                        }).always(function () {
                            $('#txtPostCodeSpinner').hide();
                        });
                    },
                    select: function (event, data) {
                        populateAddressFields(data.item.id);
                        setUppercasePostcode();
                        return false;
                    },
                    focus: function () {
                        // prevent value inserted on focus
                        return false;
                    }
                });
                setTimeout(function () {
                    $('#txtPostCode').attr("autocomplete", generateGuid());
                }, 100);
            });
        })(jQuery);
        function generateGuid() {
            var result = '';
            for (var i = 0; i < 32; i++)
                result += Math.floor(Math.random() * 16).toString(16).toUpperCase();
            return result
        }
    </script>
</body>
</html>


